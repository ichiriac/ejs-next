!function(r,t){"use strict";var c=function(t){t||(t={}),this.options={strict:t.strict||!1,localsName:t.localsName||"locals",root:t.root||"/"}};c.prototype.compile=function(t,n){var e=transpile(new lexer,t,this.options,n||"eval");try{return new Function("ejs,"+this.options.localsName,e).bind(null,this)}catch(t){var o=t.lineNumber?t.lineNumber-6:1,r=new SyntaxError(t.message,n,o);throw r.stack=t.message+"\n    at "+n+":"+o+"\n"+r.stack.split(/\n/g).slice(4).join("\n"),r}},c.compile=function(t,n){return new c(n).compile(t)},c.prototype.render=function(t,n){var e=this.compile(t)(n);return"function"==typeof e.then?e:Promise.resolve(e)};var n=/[&<>'\"]/g;c.sanitize=function(t){return"string"!=typeof t&&(t=t.toString()),t.replace(n,function(t){return"&"==t?"&amp;":"<"==t?"&lt;":">"==t?"&gt;":'"'==t?"&#34;":"'"==t?"&#39;":t})},c.prototype.output=function(){var r=[],o=null,i=[],u=-1,s=!0;return new Proxy(i,{get:function(t,n){var e;return"output"==n?(e=-1==u?"":0==u?i[0]:Promise.all(i).then(function(t){for(var n=0,e=r.length;n<e;n++){var o=r[n];t[o]=c.sanitize(null==t[o]?"":t[o])}return t.join("")}),o?0<u?e.then(function(t){return o(t)}):o(e):e):"toString"==n?this.get.bind(this,t,"output"):null},set:function(t,n,e){if(null==e)return!0;if("echo"==n)"string"!=typeof e&&"function"!=typeof e.then&&(e=e.toString()),"function"==typeof e.then?(s=!0,u++,i.push(e)):s?(i.push(e),s=!1,u++):i[u]+=e;else if("safe"==n)"string"!=typeof e&&"function"!=typeof e.then&&(e=e.toString()),"function"==typeof e.then?(s=!0,u++,r.push(u),i.push(e)):s?(i.push(c.sanitize(e)),s=!1,u++):i[u]+=c.sanitize(e);else{if("hook"!=n)throw new Error("Undefined property "+n);o=e}return!0},toString:function(){return this.get(i,"output")}})},c.render=function(t,n,e){return new c(e).render(t,n)},c.prototype.include=function(t,n,e,o){return this.renderFile(this.resolveInclude(e,n),Object.assign(t,o||{}))},c.prototype.layout=function(n,e,t,o,r){var i=this;return t.hook=function(t){return r.contents=t,i.renderFile(i.resolveInclude(o,e),Object.assign({},n,r||{}))},null},c.prototype.block=function(t,n,e){return n?(t[n]||(t[n]=this.output()),3==arguments.length?(t[n].echo="function"==typeof e?e():e,e):t[n].output):null},c.prototype.resolveInclude=function(t,n,e){return n&&"eval"!=n||(n=this.options.root,e=!0),c.resolveInclude(t,n,e)},c.resolveInclude=function(t,n,e){return n&&(e||(n=path.dirname(n)),"/"==t[0]&&(t="./"+t.replace(/^\/*/,"")),t=path.resolve(n,t)),path.extname(t)||(t+=".ejs"),t},c.prototype.renderFile=function(i,u){var s=this;return new Promise(function(o,r){i.substring(0,s.options.root.length)!=s.options.root&&(i=c.resolveInclude(i,s.options.root,!0)),fs.readFile(i,function(t,n){if(t)return r(t);try{var e=s.compile(n.toString(),i)(u);e&&"function"==typeof e.then?e.then(o).catch(r):o(e)}catch(t){return r(t)}})})},c.__express=c.renderFile=function(t,n,e){return new c(e).renderFile(t,n)},"undefined"!=typeof window?window.ejs=c:"undefined"!=typeof global&&(global.ejs=c),t&&(t.ejs=c),"function"==typeof define&&define.amd&&define("ejs",c),r&&r.fn&&(r.fn.extend({ejs:function(n,t){var e=r.fn.ejs.options;t&&(e=r.extend(!0,e,t));var o=new o(e);return this.each(function(){var t=r(this).html();o.compile(t)(n).then(function(t){r(this).html(t)}.bind(this)).catch(function(t){r(this).html('<pre class="ejs-error">'+t.toString()+"</pre>")})})}}),r.fn.ejs.options={})}(jQuery,window);