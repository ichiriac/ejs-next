!function(s,t){"use strict";var r=function(){this._buffer="",this._parts=[],this._levels=[]};r.prototype.ob_start=function(){return this._levels.push(this._parts.length),this},r.prototype.ob_end_clean=function(){if(!(0<this._levels.length))throw new Error("Bad output level, use ob_start before");return this._parts.splice(this._levels.pop()),this},r.prototype.ob_end_flush=function(){if(!(0<this._levels.length))throw new Error("Bad output level, use ob_start before");this._levels.pop()},r.prototype.ob_clean=function(){if(!(0<this._levels.length))throw new Error("Bad output level, use ob_start before");return this._parts.splice(this._levels[this._levels.length-1]),this},r.prototype.ob_get_contents=function(){if(0<this._levels.length)return Promise.all(this._parts.slice(this._levels[this._levels.length-1])).then(function(t){return t.join("")});throw new Error("Bad output level, use ob_start before")},r.prototype.ob_get_clean=function(){var t=this.ob_get_contents();return this.ob_end_clean(),t},r.prototype.ob_get_flush=function(){var t=this.ob_get_contents();return this._levels.pop(),t},r.prototype.ob_get_level=function(){return this._levels.length},r.prototype.echo=function(t){return"function"==typeof t.then?(this._parts.push(this._buffer),this._parts.push(t),this._buffer=""):this._buffer+=t,this};var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"};r.prototype.safeEcho=function(t){"function"==typeof t.then&&this.echo(Promise.resolve(t).then(function(t){return null===t?null:t.replace(/[&<>'"]/g,function(t){return e[t]})})),"string"==typeof t?this.echo(t.replace(/[&<>'"]/g,function(t){return e[t]})):this.echo(new String(t).replace(/[&<>'"]/g,function(t){return e[t]}))},r.prototype.toString=function(){return 0===this._parts.length?this._buffer:(0<this._buffer.length&&(this._parts.push(this._buffer),this._buffer=""),this._parts.join(""))},r.prototype.resolveOutput=function(){return 0===this._parts.length?Promise.resolve(this._buffer):(0<this._buffer.length&&(this._parts.push(this._buffer),this._buffer=""),Promise.all(this._parts).then(function(t){return this._buffer=t.join(""),this._parts=[],this._buffer}.bind(this)))};var h=function(t,e){this._state=[{Math:Math,Date:Date}],this._engine=e,t&&this.push(t),this._output=new r(this)};for(var n in h.prototype.push=function(t){for(var e in this._state.push(t),t)this.hasOwnProperty(e)||Object.defineProperty(this,e,{configurable:!0,enumerable:!0,get:this.get.bind(this,e),set:this.set.bind(this,e)});return this},h.prototype.pop=function(){return this._state.pop(),this},h.prototype.include=function(t,e){return"function"==typeof e&&(this.ob_start(),e(),e={contents:this.ob_get_clean()}),this.push(e),this.ob_start(),this.engine.renderFile(t,this),this.pop(),this.ob_get_clean()},r.prototype)!function(t){h.prototype[t]=function(){return this._output[t].apply(this._output,arguments)}}(n);h.prototype.set=function(t,e){return this._state[this._state.length-1][t]=e,this},h.prototype.get=function(t){if("_"!==t[0]&&h.prototype.hasOwnProperty(t))return this[t].bind(this);for(var e=this._state.length-1;-1<e;e--)if(this._state[e].hasOwnProperty(t))return this._state[e][t];return null};var i={get:function(t,e){return t.get(e)},set:function(t,e,n){return t.set(e,n)},has:function(t,e){return"_"!==e[0]&&"locals"!==e}};h.create=function(t,e){if(t instanceof Proxy||t instanceof h)return t;if(e.options.strict){var n=new r(e);return Object.assign(n,t)}return"function"==typeof Proxy?new Proxy(new h(t,e),i):new h(t,e)};var o=function(t){t||(t={}),this.options={strict:t.strict||!1,localsName:t.localsName||"locals"}};o.prototype.compile=function(t,e){e||(e="eval");var n=transpile(new lexer,t,this.options);try{return new Function(this.options.localsName,n)}catch(t){var r=t.lineNumber?t.lineNumber-6:1,s=new SyntaxError(t.message,e,r);throw s.stack=t.message+"\n    at "+e+":"+r+"\n"+s.stack.split(/\n/g).slice(4).join("\n"),s}},o.compile=function(t,e){return new o(e).compile(t)},o.prototype.render=function(t,e){return this.compile(t)(h.create(e||{},this))},o.render=function(t,e,n){return new o(n).render(t,e)},o.prototype.renderFile=function(s,i){var o=this;return new Promise(function(n,r){fs.readFile(s,function(t,e){if(t)return r(t);try{o.compile(e,s)(h.create(i||{},this)).then(n).catch(r)}catch(t){return r(t)}})})},o.__express=o.renderFile=function(t,e,n){return new o(n).renderFile(t,e)},t&&(t.ejs=o),"function"==typeof define&&define.amd&&define("ejs",o),s&&s.fn&&(s.fn.extend({ejs:function(e,t){var n=s.fn.ejs.options;t&&(n=s.extend(!0,n,t));var r=new r(n);return this.each(function(){var t=s(this).html();r.compile(t)(e).then(function(t){s(this).html(t)}.bind(this)).catch(function(t){s(this).html('<pre class="ejs-error">'+t.toString()+"</pre>")})})}}),s.fn.ejs.options={})}(jQuery,window);