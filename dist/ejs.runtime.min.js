!function(o,t){"use strict";var s=function(){this.hook=null,this.output=[],this.offset=-1,this.sanitize=[],this.isPromise=!0},e=/[&<>'\"]/g;s.sanitize=function(t){return"string"!=typeof t&&(t=t.toString()),t.replace(e,function(t){return"&"==t?"&amp;":"<"==t?"&lt;":">"==t?"&gt;":'"'==t?"&#34;":"'"==t?"&#39;":t})},s.prototype.write=function(t){if(null!=t){var e="string"!=typeof t;!e&&(t instanceof String||"function"!=typeof t.then)&&(t=t.toString(),e=!0),e?this.isPromise?(this.output.push(t),this.isPromise=!1,this.offset++):this.output[this.offset]+=t:(this.isPromise=!0,this.offset++,this.output.push(t))}},s.prototype.safe_write=function(t){if(null!=t){var e="string"!=typeof t;!e&&(t instanceof String||"function"!=typeof t.then)&&(t=t.toString(),e=!0),e?this.isPromise?(this.output.push(s.sanitize(t)),this.isPromise=!1,this.offset++):this.output[this.offset]+=s.sanitize(t):(this.isPromise=!0,this.offset++,this.sanitize.push(this.offset),this.output.push(t))}},s.prototype.toString=function(){var t;if(t=-1==this.offset?"":0==this.offset?this.output[0]:Promise.all(this.output).then(function(t){for(var e=0,n=this.sanitize.length;e<n;e++){var i=this.sanitize[e];t[i]=s.sanitize(null==t[i]?"":t[i])}return t.join("")}.bind(this)),this.hook){if(t.then)return t.then(function(t){return this.hook(t)}.bind(this));t=this.hook(t)}return t};var h=function(t){t||(t={}),this.options={strict:t.strict||!1,localsName:t.localsName||"locals",root:t.root||"/"}};h.prototype.compile=function(t,e){var n=transpile(new lexer,t,this.options,e||"eval");try{return new Function("ejs,"+this.options.localsName,n).bind(null,this)}catch(t){var i=t.lineNumber?t.lineNumber-6:1,o=new SyntaxError(t.message,e,i);throw o.stack=t.message+"\n    at "+e+":"+i+"\n"+o.stack.split(/\n/g).slice(4).join("\n"),o}},h.compile=function(t,e){return new h(e).compile(t)},h.prototype.render=function(t,e){var n=this.compile(t)(e);return"function"==typeof n.then?n:Promise.resolve(n)},h.prototype.output=function(){return new s},h.render=function(t,e,n){return new h(n).render(t,e)},h.prototype.include=function(t,e,n,i){return this.renderFile(this.resolveInclude(n,e),Object.assign(t,i||{}))},h.prototype.layout=function(e,n,t,i,o){var s=this;return t.hook=function(t){return(o=Object.assign({},e,o||{})).contents=t,s.renderFile(s.resolveInclude(i,n),o)},null},h.prototype.block=function(t,e,n){return e?(t[e]||(t[e]=this.output()),3==arguments.length?(t[e].echo="function"==typeof n?n():n,n):t[e].output):null},h.prototype.resolveInclude=function(t,e,n){return e&&"eval"!=e||(e=this.options.root,n=!0),"/"==t[0]&&(t="./"+t.replace(/^\/*/,""),e=this.options.root,n=!0),h.resolveInclude(t,e,n)},h.resolveInclude=function(t,e,n){return e&&(n||(e=path.dirname(e)),t=path.resolve(e,t)),path.extname(t)||(t+=".ejs"),t},h.prototype.renderFile=function(s,r){var u=this;return new Promise(function(i,o){s.substring(0,u.options.root.length)!=u.options.root&&(s=h.resolveInclude(s,u.options.root,!0)),fs.readFile(s,function(t,e){if(t)return o(t);try{var n=u.compile(e.toString(),s)(r);n&&"function"==typeof n.then?n.then(i).catch(o):i(n)}catch(t){return o(t)}})})},h.__express=h.renderFile=function(t,e,n){return new h(n).renderFile(t,e)},"undefined"!=typeof window?window.ejs=h:"undefined"!=typeof global&&(global.ejs=h),t&&(t.ejs=h),"function"==typeof define&&define.amd&&define("ejs",h),o&&o.fn&&(o.fn.extend({ejs:function(e,t){var n=o.fn.ejs.options;t&&(n=o.extend(!0,n,t));var i=new i(n);return this.each(function(){var t=o(this).html();i.compile(t)(e).then(function(t){o(this).html(t)}.bind(this)).catch(function(t){o(this).html('<pre class="ejs-error">'+t.toString()+"</pre>")})})}}),o.fn.ejs.options={})}(jQuery,window);