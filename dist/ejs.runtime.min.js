!function(o,t){"use strict";var s=function(){this.hook=null,this.output=[],this.offset=-1,this.sanitize=[],this.isPromise=!0},e=/[&<>'\"]/g;s.sanitize=function(t){return"string"!=typeof t&&(t=t.toString()),t.replace(e,function(t){return"&"==t?"&amp;":"<"==t?"&lt;":">"==t?"&gt;":'"'==t?"&#34;":"'"==t?"&#39;":t})},s.prototype.write=function(t){if(null!=t){var e="string"==typeof t;e||"function"==typeof t.then||(t=t.toString(),e=!0),e?this.isPromise?(this.output.push(t),this.isPromise=!1,this.offset++):this.output[this.offset]+=t:(this.isPromise=!0,this.offset++,this.output.push(t))}},s.prototype.safe_write=function(t){if(null!=t){var e="string"==typeof t;e||"function"==typeof t.then||(t=t.toString(),e=!0),e?this.isPromise?(this.output.push(s.sanitize(t)),this.isPromise=!1,this.offset++):this.output[this.offset]+=s.sanitize(t):(this.isPromise=!0,this.offset++,this.sanitize.push(this.offset),this.output.push(t))}},s.prototype.toString=function(){var t;if(t=-1==this.offset?"":0==this.offset?this.output[0]:Promise.all(this.output).then(function(t){for(var e=0,n=this.sanitize.length;e<n;e++){var i=this.sanitize[e];t[i]=s.sanitize(null==t[i]?"":t[i])}return t.join("")}.bind(this)),this.hook){if(t.then)return t.then(function(t){return this.hook(t)}.bind(this));t=this.hook(t)}return t};var c=function(t){t||(t={}),this.options={cache:t.cache||!1,strict:t.strict||!1,localsName:t.localsName||"locals",root:t.root||"/"}};c.__cache={},c.__fn={},c.prototype.compile=function(t,e){if(this.options.cache&&c.__cache.hasOwnProperty(t))return c.__cache[t];var n=new lexer;n.input(t);var i=new transpile(n,this.options,e||"eval").toString();try{var o=new Function("ejs,"+this.options.localsName,i).bind(null,this);return this.options.cache&&(c.__cache[t]=o),o}catch(t){var s=t.lineNumber?t.lineNumber-6:1,r=new SyntaxError(t.message,e,s);throw r.stack=t.message+"\n    at "+e+":"+s+"\n"+r.stack.split(/\n/g).slice(4).join("\n"),r}},c.compile=function(t,e){return new c(e).compile(t)},c.prototype.render=function(t,e){var n=this.compile(t)(e);return"function"==typeof n.then?n:Promise.resolve(n)},c.prototype.output=function(){return new s},c.render=function(t,e,n){return new c(n).render(t,e)},c.prototype.include=function(t,e,n,i){return"function"==typeof i&&(i={contents:i()}),"string"==typeof i&&(i={contents:i}),this.renderFile(this.resolveInclude(n,e),Object.assign({},t,i||{}))},c.prototype.layout=function(e,n,t,i,o){var s=this;return t.hook=function(t){return(o=Object.assign({},e,o||{})).contents=t,s.renderFile(s.resolveInclude(i,n),o)},null},c.prototype.block=function(t,e,n){return e?(t[e]||(t[e]=this.output()),3==arguments.length?(t[e].echo="function"==typeof n?n():n,n):t[e].output):null},c.prototype.resolveInclude=function(t,e,n){return e&&"eval"!=e||(e=this.options.root,n=!0),"/"==t[0]&&(t="./"+t.replace(/^\/*/,""),e=this.options.root,n=!0),c.resolveInclude(t,e,n)},c.resolveInclude=function(t,e,n){return e&&(n||(e=path.dirname(e)),t=path.resolve(e,t)),path.extname(t)||(t+=".ejs"),t},c.registerFunction=function(t,e){c.__fn[t]=e,transpile.__fn[t]=!0},c.prototype.renderFile=function(s,r){var u=this;return new Promise(function(n,i){s.substring(0,u.options.root.length)!=u.options.root&&(s=c.resolveInclude(s,u.options.root,!0));var o=function(t){try{var e=u.compile(t.toString(),s)(r);e&&"function"==typeof e.then?e.then(n).catch(i):n(e)}catch(t){return i(t)}};u.options.cache&&c.__cache.hasOwnProperty(s)?o(c.__cache[s]):fs.readFile(s,function(t,e){if(t)return i(t);u.options.cache&&(c.__cache[s]=e),o(e)})})},c.renderFile=function(t,e,n){return new c(n).renderFile(t,e)},c.__express=function(t,e,n){var i={};e.settings&&(e.settings["view cache"]&&(i.cache=!0),e.settings.views&&(i.root=e.settings.views)),c.renderFile(t,e,i).then(function(t){n(null,t)}).catch(function(t){n(t,null)})},"undefined"!=typeof window?window.ejs=c:"undefined"!=typeof global&&(global.ejs=c),t&&(t.ejs=c),"function"==typeof define&&define.amd&&define("ejs",c),o&&o.fn&&(o.fn.extend({ejs:function(e,t){var n=o.fn.ejs.options;t&&(n=o.extend(!0,n,t));var i=new i(n);return this.each(function(){var t=o(this).html();i.compile(t)(e).then(function(t){o(this).html(t)}.bind(this)).catch(function(t){o(this).html('<pre class="ejs-error">'+t.toString()+"</pre>")})})}}),o.fn.ejs.options={})}(jQuery,window);