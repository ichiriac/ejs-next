!function(o,t){"use strict";var r=function(){this.open_tag="<%",this.close_tag="%>",this.char_comment="#",this.char_output="=",this.char_html="-",this.char_strip="_",this.char_ignore="%"};r.tokens={T_EOF:0,T_INLINE:1,T_OPEN:2,T_CLOSE:3,T_OPT_COMMENT:4,T_OPT_CLEAN_OUTPUT:5,T_OPT_OUTPUT:6,T_OPT_WS_STRIP:7,T_OPT_NL_STRIP:8,T_CLOSE_STRIP:9,T_SOURCE:10,T_WHITESPACE:11,T_TEXT:12,T_COMMENT:13,T_IDENTIFIER:14,T_OPEN_BRACKET:15,T_CLOSE_BRACKET:16,T_OPEN_PARA:17,T_CLOSE_PARA:18,T_DBL_COLON:19,T_OPEN_CAPTURE:20,T_CLOSE_CAPTURE:21},r.states={S_INLINE:0,S_TAG:1,S_SOURCE:2},r.prototype.input=function(t){this.source=t,this.offset=-1,this.prev_offset=this.offset,this.lastOffset=t.length-1,this.lookupOffset=t.length-2,this.state=r.states.S_INLINE,this.current=null},r.prototype.token=function(t){var s=this.prev_offset>this.lastOffset?null:this.source.substring(this.prev_offset,this.offset+1);return this.current=[t,s,this.prev_offset,this.offset+1],this.current},r.prototype.next=function(){var t;for(this.prev_offset=this.offset+1;++this.offset<this.lastOffset;)if(this.state===r.states.S_INLINE){if(this.offset=this.source.indexOf(this.open_tag,this.offset),-1!==this.offset){if(this.source[this.offset+2]===this.char_ignore)continue;return this.state=r.states.S_TAG,this.offset--,this.token(r.tokens.T_INLINE)}this.offset=this.lastOffset}else{if(this.state!==r.states.S_TAG){if(" "==(t=this.source[this.offset])||"\n"==t||"\t"==t||"\r"==t){for(;++this.offset<this.lastOffset;)if(" "!=(t=this.source[this.offset])&&"\n"!=t&&"\t"!=t&&"\r"!=t){this.offset--;break}return this.token(r.tokens.T_WHITESPACE)}if("'"==t||'"'==t||"`"==t){for(;++this.offset<this.lastOffset;){var s=this.source[this.offset];if("\\"!=s){if(s==t)break}else this.offset++}return this.token(r.tokens.T_TEXT)}if("/"==t&&"*"==this.source[this.offset+1]){for(;++this.offset<this.lastOffset;)if("*"==(t=this.source[this.offset])&&"/"==this.source[this.offset+1]){++this.offset;break}return this.token(r.tokens.T_COMMENT)}if("a"<=t&&t<="z"||"A"<=t&&t<="Z"||"_"==t||"$"==t){for(;++this.offset<this.lastOffset;)if(!("a"<=(t=this.source[this.offset])&&t<="z"||"A"<=t&&t<="Z"||"0"<=t&&t<="9"||"_"==t||"$"==t||"."==t)){this.offset--;break}if("_"!=this.source[this.offset]||this.prev_offset<this.offset)return this.token(r.tokens.T_IDENTIFIER)}if("("==t)return this.token(r.tokens.T_OPEN_PARA);if(")"==t)return this.token(r.tokens.T_CLOSE_PARA);if("{"==t)return"@"==this.source[this.offset+1]?(this.offset++,this.token(r.tokens.T_OPEN_CAPTURE)):this.token(r.tokens.T_OPEN_BRACKET);if("@"==t&&"}"==this.source[this.offset+1])return this.offset++,this.token(r.tokens.T_CLOSE_CAPTURE);if("}"==t)return this.token(r.tokens.T_CLOSE_BRACKET);if(":"==t)return this.token(r.tokens.T_DBL_COLON);if(","==t)return this.token(r.tokens.T_SOURCE);if(";"==t)return this.token(r.tokens.T_SOURCE);if("="==t)return this.token(r.tokens.T_SOURCE);do{if((t=this.source[this.offset])==this.close_tag[0]&&this.source.substring(this.offset,this.offset+this.close_tag.length)==this.close_tag){var e=this.source[this.offset-1]==this.char_strip,i=this.source[this.offset-1]==this.char_html;return(e||i)&&this.offset--,this.prev_offset==this.offset?(this.state=r.states.S_INLINE,this.offset+=this.close_tag.length,e?this.token(r.tokens.T_CLOSE_STRIP):i?this.token(r.tokens.T_OPT_NL_STRIP):(this.offset--,this.token(r.tokens.T_CLOSE))):(this.offset--,this.token(r.tokens.T_SOURCE))}if(t!=this.char_strip&&t!=this.char_html||this.source[this.offset+1]!=this.close_tag[0]){if(" "==t||"\t"==t||"\r"==t||"\n"==t)break;if("a"<=t&&t<="z")break;if("A"<=t&&t<="Z")break;if("_"==t||"$"==t)break;if("("==t||")"==t)break;if('"'==t||"'"==t||"`"==t)break;if("{"==t||"}"==t||":"==t||"@"==t||"="==t||";"==t||","==t)break}}while(++this.offset<this.lastOffset);return this.offset--,this.token(r.tokens.T_SOURCE)}if((t=this.source[this.offset])!==this.open_tag[0])return this.state=r.states.S_INLINE,t==this.char_strip?(this.offset+=this.close_tag.length,this.token(r.tokens.T_CLOSE_STRIP)):t==this.char_html?(this.offset+=this.close_tag.length,this.token(r.tokens.T_OPT_NL_STRIP)):(this.offset+=this.close_tag.length-1,this.token(r.tokens.T_CLOSE));switch(this.state=r.states.S_SOURCE,this.offset+=this.open_tag.length,t=this.source[this.offset]){case this.char_comment:return this.state=r.states.S_INLINE,this.offset=this.source.indexOf(this.close_tag,this.offset),-1==this.offset?this.offset=this.lastOffset:this.offset+=this.close_tag.length-1,this.token(r.tokens.T_OPT_COMMENT);case this.char_output:return this.token(r.tokens.T_OPT_CLEAN_OUTPUT);case this.char_html:return this.token(r.tokens.T_OPT_OUTPUT);case this.char_strip:return this.token(r.tokens.T_OPT_WS_STRIP);default:return this.offset--,this.token(r.tokens.T_OPEN)}}return this.prev_offset===this.offset?this.token(r.tokens.T_EOF):this.token(r.tokens.T_INLINE)};var h=require("source-list-map").SourceListMap,e={abstract:!0,else:!0,instanceof:!0,super:!0,boolean:!0,enum:!0,int:!0,switch:!0,break:!0,export:!0,interface:!0,synchronized:!0,byte:!0,extends:!0,let:!0,this:!0,case:!0,false:!0,long:!0,throw:!0,catch:!0,final:!0,native:!0,throws:!0,char:!0,finally:!0,new:!0,transient:!0,class:!0,float:!0,null:!0,true:!0,const:!0,for:!0,package:!0,try:!0,continue:!0,function:!0,private:!0,typeof:!0,debugger:!0,goto:!0,protected:!0,var:!0,default:!0,if:!0,public:!0,void:!0,delete:!0,implements:!0,return:!0,volatile:!0,do:!0,import:!0,short:!0,while:!0,double:!0,in:!0,static:!0,with:!0,layout:!0,include:!0,block:!0,Math:!0,Array:!0,Object:!0,String:!0,Function:!0,Date:!0,require:!0,window:!0,document:!0,$:!0,module:!0},n=function(t,s,e){this.code=new h,this.source="",this.source_offset=0,this.lexer=t,this.locals=[{}],this.mappings=[],this.filename=e,this.names=[],this.useInclude=!1,this.useLayout=!1,this.useBlock=!1,this.opts=s||{},this.helpers={},this.tmp=0,this.opts.localsName||(this.opts.localsName="locals");var i="";for(var o in this.opts.strict&&(i+="\n"),i+="if (arguments.length < 2) {\n",i+="\t"+this.opts.localsName+" = ejs;\n",i+='\tejs = (typeof global != "undefined" && global.ejs) || (typeof window != "undefined" && window.ejs);\n',i+='\tif(!ejs) return Promise.reject(new Error("EJS module is not loaded"));\n',i+="\tejs = new ejs("+JSON.stringify(this.opts)+");\n",i+="}\n",i+=this.opts.localsName+" = "+this.opts.localsName+" || {};\n",i+="var include = ejs.include.bind(ejs, "+this.opts.localsName+', "'+e+'");\n',i+="var block = ejs.block.bind(ejs, "+this.opts.localsName+");\n",i+="var _$e = ejs.output();\n",i+="ejs._output = _$e;\n",i+="var layout = ejs.layout.bind(ejs, "+this.opts.localsName+', "'+e+'", _$e);\n',this.setLocalVar(this.opts.localsName),this.next().parseBody(),this.helpers)i+="var "+o+" = ejs.constructor.__fn."+o+".bind(ejs, "+this.opts.localsName+");\n";if(0<this.tmp){i+="var f1=null";for(var n=1;n<this.tmp;n++)i+=",f"+(n+1)+"=null";i+=";\n"}this.code.preprend(i),this.write("\nreturn _$e.toString();\n")};n.__fn={},n.prototype.next=function(){return this.tok=this.lexer.next(),this.source+=this.tok[1],"{"==this.tok[1]&&(this.inObject=!0),"}"==this.tok[1]&&(this.inObject=!1),":"==this.tok[1]?this.inKey=!0:this.inKey=!1,this},n.prototype.nextTok=function(){for(this.next();(this.tok[0]==r.tokens.T_WHITESPACE||this.tok[0]==r.tokens.T_COMMENT)&&(this.write().next(),this.tok[0]!=r.tokens.T_EOF););return this},n.prototype.write=function(t){return t||(t=this.tok[1]),this.source_offset!=this.source.length?(this.code.add(t,this.filename,this.source.substring(this.source_offset,this.source.length)),this.source_offset=this.source.length):this.code.add(t),this},n.prototype.toString=function(){var t=this.code.toStringWithSourceMap();t.map.sourcesContent=this.source;new Buffer(JSON.stringify(t.map));return t.source},n.prototype.isReserved=function(t){if(t=t.split(".",2)[0],e[t])return!0;if(n.__fn[t])return!0;for(var s=this.locals.length-1;-1<s;s--)if(this.locals[s][t])return!0;return!1},n.prototype.setLocalVar=function(t){return t||(t=this.tok[1]),this.locals[this.locals.length-1][t]=!0,this},n.prototype.parseValue=function(t){for(;this.tok[0]!=r.tokens.T_EOF;){if(this.tok[1]==t)return this;if("("==this.tok[1]&&this.write().nextTok().parseValue(")"),"{"==this.tok[1]&&this.write().nextTok().parseValue("}"),"["==this.tok[1]&&this.write().nextTok().parseValue("]"),"function"==this.tok[1]&&this.write().nextTok().parseFunction(),!t&&(";"==this.tok[1]||","==this.tok[1]))return this;if(this.tok[0]==r.tokens.T_IDENTIFIER){var s=this.tok[1];this.nextTok(),this.inObject&&this.inKey?this.write(s+" "):this.isReserved(s)?(n.__fn[s]&&(this.helpers[s]||(this.helpers[s]=!0)),this.write(s+" ")):this.opts.strict?this.write(this.opts.localsName+"."+s+" "):this.safeVar(s)}else this.write().nextTok()}return this},n.prototype.safeVar=function(t){t=t.split(".");var s=this.opts.localsName;if("("==this.tok[1]){for(var e=0;e<t.length-1;e++)s="("+s+"."+t[e]+' || "")';this.write("(( (f"+ ++this.tmp+" = "+s+") && f"+this.tmp+" && typeof f"+this.tmp+'["'+t[t.length-1]+'"] == "function") ? f'+this.tmp+'["'+t[t.length-1]+'"]('),this.nextTok().parseValue(")"),this.write('): "") ').nextTok()}else{for(e=0;e<t.length;e++)s="("+s+"."+t[e]+' || "")';this.write(s+" ")}},n.prototype.parseVar=function(){if(this.tok[0]==r.tokens.T_IDENTIFIER&&this.setLocalVar().write().nextTok(),"="==this.tok[1]&&this.write().nextTok().parseValue(),","==this.tok[1]&&this.write().nextTok().parseVar(),";"==this.tok[1])return this.write().nextTok()},n.prototype.parseFunction=function(t){for(this.tok[0]==r.tokens.T_IDENTIFIER&&this.setLocalVar().write().nextTok(),this.locals.push({}),this.tok[0]==r.tokens.T_OPEN_PARA&&this.write()&&this.nextTok(),this.tok[0]==r.tokens.T_IDENTIFIER&&this.setLocalVar().write().nextTok();","==this.tok[1]&&(this.write().nextTok(),this.tok[0]!=r.tokens.T_CLOSE_PARA);)this.setLocalVar().write().nextTok();this.tok[0]==r.tokens.T_CLOSE_PARA&&this.write().nextTok(),this.tok[0]==r.tokens.T_OPEN_CAPTURE?(this.write("{\nvar _$e = ejs.output();\n"),this.nextTok().parseBody(r.tokens.T_CLOSE_CAPTURE),this.write("\nreturn _$e.toString();\n}"+(t?")":"")),this.tok[0]==r.tokens.T_CLOSE_CAPTURE&&this.nextTok()):(this.tok[0]==r.tokens.OPEN_BRACKET&&this.write().nextTok(),this.parseBody(r.tokens.CLOSE_BRACKET),this.tok[0]==r.tokens.CLOSE_BRACKET&&this.write().nextTok()),this.locals.pop()},n.prototype.parseBody=function(t){for(;;)if(this.tok[0]==r.tokens.T_INLINE){var s=this.tok[1];this.next().tok[0]==r.tokens.T_OPT_WS_STRIP&&(s=s.replace(/[ \t]+$/,"")),0<s.length&&this.write("_$e.write(`"+s.replace("`","\\`")+"`);\n")}else{if(this.tok[0]==r.tokens.T_EOF||this.tok[0]==t)break;if(this.tok[0]==r.tokens.T_OPT_COMMENT)this.write("/* "+this.tok[1].replace("/","?")+" */\n").next();else{var e=!1;for(this.tok[0]==r.tokens.T_OPT_OUTPUT?(this.write("_$e.write("),e=!0,this.nextTok()):this.tok[0]==r.tokens.T_OPT_CLEAN_OUTPUT?(this.write("_$e.safe_write("),e=!0,this.nextTok()):this.tok[0]!=r.tokens.T_OPEN&&this.tok[0]!=r.tokens.T_OPT_WS_STRIP||(e=!1,this.nextTok());this.tok[0]!=r.tokens.T_EOF&&this.tok[0]!=r.tokens.T_CLOSE&&this.tok[0]!=r.tokens.T_CLOSE_STRIP&&this.tok[0]!=r.tokens.T_OPT_NL_STRIP;){if(this.tok[0]==t)return this;if(this.tok[0]==r.tokens.T_IDENTIFIER){if("function"!=this.tok[1]){if("var"==this.tok[1]||"let"==this.tok[1]||"const"==this.tok[1]){this.write("var").nextTok().parseVar();continue}var i=this.tok[1];this.nextTok(),this.inObject&&this.inKey?this.write(i+" "):this.isReserved(i)?(n.__fn[i]&&(this.helpers[i]||(this.helpers[i]=!0)),this.write(i+" ")):this.opts.strict?this.write(this.opts.localsName+"."+i+" "):this.safeVar(i);continue}this.write().nextTok().parseFunction(e)}else this.write();this.nextTok()}e?this.write(");\n"):this.write(";");var o=this.tok[0];this.next().tok[0]==r.tokens.T_INLINE&&(o==r.tokens.T_CLOSE_STRIP?this.tok[1]=this.tok[1].replace(/^[ \t]*\n?/,""):o==r.tokens.T_OPT_NL_STRIP&&(this.tok[1]=this.tok[1].replace(/^[ \t]*\n?/,"")))}}return this};var f=function(){this.hook=null,this.output=[],this.offset=-1,this.sanitize=[],this.isPromise=!0},s=/[&<>'\"]/g;f.sanitize=function(t){return"string"!=typeof t&&(t=t.toString()),t.replace(s,function(t){return"&"==t?"&amp;":"<"==t?"&lt;":">"==t?"&gt;":'"'==t?"&#34;":"'"==t?"&#39;":t})},f.prototype.buffer=function(t){var s=this.hook,e=this.output,i=this.offset,o=this.sanitize,n=this.isPromise;return this.hook=null,this.output=[],this.offset=-1,this.sanitize=[],this.isPromise=!0,function(){var t=this.toString();return this.hook=s,this.output=e,this.offset=i,this.sanitize=o,this.isPromise=n,t}.bind(this)},f.prototype.write=function(t){if(null!=t){var s="string"==typeof t;s||"function"==typeof t.then||(t=t.toString(),s=!0),s?this.isPromise?(this.output.push(t),this.isPromise=!1,this.offset++):this.output[this.offset]+=t:(this.isPromise=!0,this.offset++,this.output.push(t))}},f.prototype.safe_write=function(t){if(null!=t){var s="string"==typeof t;s||"function"==typeof t.then||(t=t.toString(),s=!0),s?this.isPromise?(this.output.push(f.sanitize(t)),this.isPromise=!1,this.offset++):this.output[this.offset]+=f.sanitize(t):(this.isPromise=!0,this.offset++,this.sanitize.push(this.offset),this.output.push(t))}},f.prototype.toString=function(){var t;if(t=-1==this.offset?"":0==this.offset?this.output[0]:Promise.all(this.output).then(function(t){for(var s=0,e=this.sanitize.length;s<e;s++){var i=this.sanitize[s];t[i]=f.sanitize(null==t[i]?"":t[i])}return t.join("")}.bind(this)),this.hook){if(t.then)return t.then(function(t){return this.hook(t)}.bind(this));t=this.hook(t)}return t};var a=function(t){t||(t={}),this.options={cache:t.cache||!1,strict:t.strict||!1,localsName:t.localsName||"locals",root:t.root||"/"},this._session={}};a.__cache={},a.__fn={},a.prototype.compile=function(t,s){if(this.options.cache&&a.__cache.hasOwnProperty(t))return a.__cache[t];var e=new r;e.input(t);var i=new transpile(e,this.options,s||"eval").toString();try{var o=new Function("ejs,"+this.options.localsName,i).bind(null,this);return this.options.cache&&(a.__cache[t]=o),o}catch(t){var n=t.lineNumber?t.lineNumber-6:1,h=new SyntaxError(t.message,s,n);throw h.stack=t.message+"\n    at "+s+":"+n+"\n"+h.stack.split(/\n/g).slice(4).join("\n"),h}},a.compile=function(t,s){return new a(s).compile(t)},a.prototype.render=function(t,s){var e=this.compile(t)(s);return"function"==typeof e.then?e:Promise.resolve(e)},a.prototype.output=function(){return new f},a.render=function(t,s,e){return new a(e).render(t,s)},a.prototype.include=function(t,s,e,i){return"function"==typeof i&&(i={contents:i()}),"string"==typeof i&&(i={contents:i}),this.renderFile(this.resolveInclude(e,s),Object.assign({},t,i||{}))},a.prototype.layout=function(s,e,t,i,o){var n=this;return t.hook=function(t){return(o=Object.assign({},s,o||{})).contents=t,n.renderFile(n.resolveInclude(i,e),o)},null},a.prototype.block=function(t,s,e){if(!s)return null;if(this._session[s]||(this._session[s]=this.output()),3!=arguments.length)return this._session[s].toString();if("function"==typeof e){var i=this._output.buffer();e(),e=i()}return this._session[s].write(e),this._session[s]},a.prototype.resolveInclude=function(t,s,e){return s&&"eval"!=s||(s=this.options.root,e=!0),"/"==t[0]&&(t="./"+t.replace(/^\/*/,""),s=this.options.root,e=!0),a.resolveInclude(t,s,e)},a.resolveInclude=function(t,s,e){return s&&(e||(s=path.dirname(s)),t=path.resolve(s,t)),path.extname(t)||(t+=".ejs"),t},a.registerFunction=function(t,s){a.__fn[t]=s,transpile.__fn[t]=!0},a.prototype.renderFile=function(n,h){var r=this;return new Promise(function(e,i){n.substring(0,r.options.root.length)!=r.options.root&&(n=a.resolveInclude(n,r.options.root,!0));var o=function(t){try{var s=r.compile(t.toString(),n)(h);s&&"function"==typeof s.then?s.then(e).catch(i):e(s)}catch(t){return i(t)}};r.options.cache&&a.__cache.hasOwnProperty(n)?o(a.__cache[n]):fs.readFile(n,function(t,s){if(t)return i(t);r.options.cache&&(a.__cache[n]=s),o(s)})})},a.renderFile=function(t,s,e){return new a(e).renderFile(t,s)},a.__express=function(t,s,e){var i={};s.settings&&(s.settings["view cache"]&&(i.cache=!0),s.settings.views&&(i.root=s.settings.views)),a.renderFile(t,s,i).then(function(t){if(!e||"function"!=typeof e)throw new Error("No response callback");e(null,t)}).catch(function(t){if(!e||"function"!=typeof e)throw t;e(t,null)})},"undefined"!=typeof window?window.ejs=a:"undefined"!=typeof global&&(global.ejs=a),t&&(t.ejs=a),"function"==typeof define&&define.amd&&define("ejs",a),o&&o.fn&&(o.fn.extend({ejs:function(s,t){var e=o.fn.ejs.options;t&&(e=o.extend(!0,e,t));var i=new i(e);return this.each(function(){var t=o(this).html();i.compile(t)(s).then(function(t){o(this).html(t)}.bind(this)).catch(function(t){o(this).html('<pre class="ejs-error">'+t.toString()+"</pre>")})})}}),o.fn.ejs.options={})}(jQuery,window);